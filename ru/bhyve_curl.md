# Работа с bhyve VM (curl)

## Описание

Большинство образов, которые вы можете использовать в MyB, являются образами виртуальных машин для запуска в гипервизоре bhyve.
Это полноценный высокопроизводительный гипервизор второго типа, поставляемого с FreeBSD ОС.

В зависимости от профиля и сетевой архитектуры, вы можете создавать виртуальные машины с одним или несколькими виртуальными интерфейсами,
с внешним или приватным адресом, получить как IPv4, так и IPv6.

## Создание bhyve VM

Для создания контейнера, используйте [endpoint](api.md): **'/api/v1/create/'**.

Минимальный payload для создания окружения на базе bhyve VM:

```
{
  "imgsize": "10g",
  "ram": "1g",
  "cpus": "2",
  "image": "debian11",
  "pubkey": "ssh-ed25519 AAAA..XXX your@localhost"
}
```

, где 'debian11' - это один из доступных образов из [Списка образов](images.md). Например, создание виртуальной машины debian11:

1)
```
cat > debian11.json <<EOF
{
  "imgsize": "10g",
  "ram": "1g",
  "cpus": "2",
  "image": "debian11",
  "pubkey": "ssh-ed25519 AAAA..XXX your@localhost"
}
```

2)
> curl --no-progress-meter -X POST -H "Content-Type: application/json" -d @debian11.json http://HOST/api/v1/create/vm1

Обратите внимание, что время на создание первой виртуальной машины каждого профиля зависит от наличия 'образа' и качества вашего Internet соединения. 
Рекомендуется через запуск 'bhyve VM' в  шелл оболочки администраторской консоли сначала получить образ. Если вы этого не сделаете, при запросе на /create,
система автоматически сначала выкачает нужный образ, затем сконвертирует в ZFS Volume и только после этого создаст и запустит ВМ. Все последующие
запуски ВМ определенного образа будут происходить мгновенно.


## Статус bhyve VM

Для просмотра информации по виртуальной машине, используйте свой token/CID и [endpoint](api.md): **'/api/v1/status/'**, например:

1) Если не знаете свой токен, получите его из вашего pubkey:
>  md5sum -qs 'ssh-ed25519 AAAA..XXX your@localhost'
> 90af7aa8bc164240521753a105df6a05

2) Посмотреть информацию по виртуальной машине 'vm1', используя токен:
> curl -H cid:90af7aa8bc164240521753a105df6a05 http://HOST/api/v1/status/vm1

Среди информации по статусу окружения, вы можете найти порт (он может быть динамический, если используется expose портов) и IP адрес для соединения в контейнер через SSH.


## Удаление bhyve VM

Для удаления bhyve VM, используйте свой token/CID и [endpoint](api.md): **'/api/v1/status/'**, например:

1) Если не знаете свой токен, получите его из вашего pubkey:
>  md5sum -qs 'ssh-ed25519 AAAA..XXX your@localhost'
> 90af7aa8bc164240521753a105df6a05

2) Удалите контейнер с использованием вашего токена:
> curl -H cid:90af7aa8bc164240521753a105df6a05 http://HOST/api/v1/destroy/vm1


---

Дальше: [Работа с Kubernetes (curl)](k8s_curl.md)
