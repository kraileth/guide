# Работа с Kubernetes (curl

## Описание

Инструмент [Kubernetes](https://kubernetes.io/) очень популярен в среде DevOPS и позиционируется как операционная система для контейнеров, где основные функции продукта - автоматический скейлинг, автоматизация деплоя, менеджмент контейнеров и т.д. С точки зрения системы, Kubernetes - это изолированные окружения (dedicated сервера, виртуальные машины) обеспечивающие runtime окружения для контейнеров и в свою очередь, эти окружения могут масштабироваться. Так, кубернетес кластер может состоять как из одного хоста (или виртуальной машины), так и от десятков и сотен окружений. С учетом тех плюсов, которые дает нам виртуализация (DRS, управление питанием, легкий способ унифицировать окружения на разном типе физических хостов), деплой Kubernetes зачастую очень выгодно выглядит  в виртуализированных средах, таких как MyB. Также, деплой Kubernetes в MyB - это один из примеров расширения API и использования инструментария по генерации gold образов, когда на базовую систему на базе Linux были установлен

## Создание K8S

Для создания контейнера, используйте [endpoint](api.md): **'/api/v1/create/'**.

Минимальный payload для создания окружения на базе jail:

```
{
}
```

Например:

1)
```
cat > k8sjson <<EOF
{
}
```

2)
> curl --no-progress-meter -X POST -H "Content-Type: application/json" -d @jail.json http://HOST/api/v1/create/k1

Пример payload для создания kubernetes кластера:
```
{
}

```

Обратите внимание, что время на создания первого контейнера зависит от наличия образа 'jail' и качества вашего Internet соединения. 
Рекомендуется через запуск 'jail' в  шелл оболочки администраторской консоли сначала получить образ. Если вы этого не сделаете, при запросе на /create,
система автоматически сначала выкачает архив rootfs для FreeBSD, затем распакует на файловую систему и только после этого создаст и запустит контейнер. 
Все последующие запуски контейнеров будут происходить мгновенно.


## Статус Kubernetes

Для просмотра информации по контейнеру, используйте свой token/CID и [endpoint](api.md): **'/api/v1/status/'**, например:

1) Если не знаете свой токен, получите его из вашего pubkey:
>  md5sum -qs 'ssh-ed25519 AAAA..XXX your@localhost'
> 90af7aa8bc164240521753a105df6a05

2) Посмотреть информацию по контейнеру jail1, используя токен:
> curl -H cid:90af7aa8bc164240521753a105df6a05 http://HOST/api/v1/status/jail1

Среди информации по статусу окружения, вы можете найти порт (он может быть динамический, если используется expose портов) и IP адрес для соединения в контейнер через SSH.


## Удаление Kubernetes

Для удаления jail, используйте свой token/CID и [endpoint](api.md): **'/api/v1/status/'**, например:

1) Если не знаете свой токен, получите его из вашего pubkey:
>  md5sum -qs 'ssh-ed25519 AAAA..XXX your@localhost'
> 90af7aa8bc164240521753a105df6a05

2) Удалите контейнер с использованием вашего токена:
> curl -H cid:90af7aa8bc164240521753a105df6a05 http://HOST/api/v1/destroy/jail1


---

Дальше: [Работа с jail (CBSDfile)](jail_cbsdfile.md)
