# Сетевые профили

## Описание

Виртуальные окружения обычно не являются конечной самоцелью для создающих их пользователей и призваны выполнять определенную функцию, в зависимости от поставленных задач. Поскольку пользователи имеют различные задачи, условия и ограничения в которых проинсталлирована платформа, это приводит к появлению определенных требований к конфигурированию сетевых настроек и виртуальных машин. Например, у ряда пользователей в наличии лишь один сервер с единственным внешним IPv4. У других есть один внешний IPv4, но также много внешних IPv6 адресов. У третьих в наличии внешние IPv4 адреса, которые должны быть назначены виртуальным окружениям. И так далее - большое число различных вариаций.

Чтобы избавить пользователей от сложного процесса реконфигурирования настроек хостовой системы, проект MyB реализовывает последовательности конфигураций в именованные группы - профили, среди которых пользователь выбирает наиболее оптимальный для себя сценарий.

Профили влияют на то, какие адреса и сетевая маршрутизация будут использованы при заказе виртуальных машин и kubernetes кластеров. Вы можете переключать профили (и тем самым реконфигурировать MyB ) неограниченное количество раз. Единственное ограничение - для переключения на новый профиль, все виртуальные окружения сделанные при старом профиле, должны быть предварительно уничтожены. По мере получения от пользователей обратной связи, количество профилей и их разновидность будет увеличиваться.

## Переключение профиля

Для смены профиля, служит пункт 'Change VM network profile':

![net](https://user-images.githubusercontent.com/926409/163693214-04a0f579-e36c-44d2-a877-2b790f90291d.png)

Не все профили могут быть активизированны до тех пор, пока не будут достигнуты определенные требования, например, вы не сможете задействовать профиль, регулирующий выдачу виртуальным окружениям IPv6 адресов, если вы не настроили IPv6 на самом хосте.

Профили применяются мгновенно при вводе соответствующего номера профиля и подтверждения по клавише 'Enter'.

![net](https://user-images.githubusercontent.com/926409/163694702-63a21af7-aaea-4d68-a97f-dd0e55b360bf.png)

Перейдем к описанию профилей и возможных топологий сети.

## 1) Single NIC: private IPv4

Профиль по-умолчанию. Первая классическая инсталляция, когда вы имеете сервер с одним внешним IPv4 адресом. Типичная сетевая конфигурация виртуальных окружений - IPv4 адрес из приватной (rfc1918) сети, с выходом в сеть Internet посредством NAT и возможностью редиректа отдельных сервисов/портов внутрь, используя свободные порты внешнего IPv4 адреса хоста.

Также, этот профиль может покрывать два кейса:

Мапинг/форвард 1:1 дополнительных внешних IPv4 адресов на любую из виртуальных машин, elastic IP. Так, виртуальная машина запускается с приватным  IPv4 адресом, но выделенный для ВМ внешний IPv4 адрес гарантирует, что любое обращение на любой порт внешнего адреса по протоколам tcp/udp, будет проброшено по тем же портам на адрес виртуальной машины. Также, ВМ при выходе трафика наружу будет использовать выделенный адрес в качестве NAT, а не общий. 

## 2) Multi NIC: private IPv4

Второй классический профиль. Инсталляция, аналогичная первому профилю, но в дополнение к единственному (или очень ограниченному количеству внешних IPv4 адресов), ваш хост сконфигурирован для использования IPv6 адресов. В этом случае, виртуальные окружения создаются с двумя виртуальными интерфейсами, где первый интерфейс аналогичен профилю 1: назначен IPv4 адрес из приватной (rfc1918) сети, с выходом в сеть Internet при работе с IPv4 стеком через NAT и возможностью редиректа отдельных сервисов/портов по IPv4 внутрь, используя свободные порты внешнего IPv4 адреса хоста. Второй же интерфейс сконфигурирован и получает внешний IPv6 адрес и отдельный 'default router' с выходом в сеть интернет при работе IPv6 стека.

В этом случае, если ваш домашний компьютер или другие ресурсы работают по IPv6 протоколу, вы сможете работать с виртуальным окружением напрямую по внешнему адресу, без каких-либо редиректов и форвардов.


---

Дальше: [ACL и безопасность](acl.md)
