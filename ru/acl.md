# ACL и безопасность

## Описание

MyBee дистрибутив на данный момент позиционируется как инструмент, применяемый в 'Trusted environments' и частной инфраструктуре и по этой причине, не должен быть использован в публичных сетях общего пользования. Тем не менее, для ограничений использования API вы можете через консоль администратора настроить следующие ограничения:

1) Ввести 'whitelist' по IP адресам, которые могут работать с API. Все IP адреса, которые НЕ присутствуют в списке, будут получать 'permission deny' при работе с API;
2) Ввести 'whitelist' для 'pubkey', которые могут работать с API. Все 'pubkey' (и соответственно, CID-токены от них), которые НЕ присутствуют в списке, будут получеть 'permission deny' при работе с API;
3) Установите и проксируйте перед MyB API собственный балансер, на котором вы можете сделать дополнительную защиту, сертификаты и тд.;

Для редактирования ACL по IP адресам и/или pubkey, используйте пункты меню: **'11) Configure Hosts Allow for API'** и **'12) Configure Pubkey WhiteList'** соответственно. Обратите внимание, что сразу после установки, по-умолчанию ACL выключен и платформа обслуживает любыех пользователей.

![acl](https://user-images.githubusercontent.com/926409/163979082-679d4701-9dcc-47a4-b3fe-46a88b518507.png)


## IP ACL

Для включения фильтра по IP адресам, используйте доступ в консоль администратора. При входе в меню, работает триггерная система и если ACL был выключен, система спрашивает о активации или сохранении предыдущего состояния.:

> Turn ACL ON? ('n' or '0' - leave as disabled) 
> [yes(1) or no(0)]

Если вы отключаете ACL, интерактивное конфигурирование на данном этапе заканчивается - вы вернетесь в основное меню, а платформа выключит ACL.
Если вы активируете или оставляете ACL рабочим, вы перейдете в режим редактирования белых списков IP адресов. Формат записи - 1 IP адрес на строчку. Поддерживаются как IPv4, так и IPv6:

![image](https://user-images.githubusercontent.com/926409/163980936-83f07d24-12c8-4082-9580-04d847fc49d9.png)

Используя 'F2 save' для сохранения списка и выйдя из редактора ( выход через клавишу 'Esc' или 'F10', при этом вам также будет предложено сохранить файл, если вы этого не сделали через 'F2' ), ACL вступают в силу и обращения на не публичные endpoint-ы API для ресурсов, отсутствующих в списке, обслуживаться не будут:

```
$ curl http://mb.convectix.com/images
<html>
<head><title>403 Forbidden</title></head>
<body>
<center><h1>403 Forbidden</h1></center>
<hr><center>nginx</center>
</body>
</html>
$ 
```

## PUBKEY ACL

Аналогичный фильтр по доступу к не публичным endpoint API может быть достигнут на уровне перечисления публичных ключей ([как мы помним](api.md), в инсталляции по-умолчанию они являются источником ClientID, **cid** ).

![image](https://user-images.githubusercontent.com/926409/163996796-e046ed4b-c8ba-43f2-8eba-4168bd283638.png)

Вставляйте публичные ключи OpenSSH (полный формат: '<тип ключа> <payload> <comment>') - один ключ на одну строчку:

![image](https://user-images.githubusercontent.com/926409/163997697-1aa6bf73-b078-4de9-977b-c531d961b2bf.png)

После сохранения списка и включения ACL, попытки работы через CID неизвестных ключей обслуживаться не будут:

![image](https://user-images.githubusercontent.com/926409/163998402-063cf00f-a036-43cf-8922-e3df83209e6f.png)



Также, ACL по API и PUBKEY не взаимозаменяемые и могут комбинироваться.


---

Дальше: [Базовые эндпоинты API](api.md)
